<h1><%= @build.project.name %> - build #<%= @build.number %></h1>
<div>
<% if @build.pull_id %>
    View pull request on <%= link_to "GitHub", "https://www.github.com/#{@build.project.full_name}/pulls/#{@build.pull_id}" %>.
<% end %>
</div>
<input type="checkbox" <%= @should_dedupe_issues ? "checked" : '' %> id="dedupe" onclick="toggleIssueDedupe(this)"> <label for="dedupe">Show only first issue of each kind</label>

<% issues_seen = {} %>
<% if @build.issues.any? %>
  <% @all_issues.each do |tests, files| %>
    <% files.each do |file_name, issues_by_line| %>
      <% if issues_by_line.any? %>
        <h4><code><span><%= file_name %></span></code></h4>
        <table class="table table-hover">
          <% issues_by_line.each do |line_number, issues| %>
            <% dedupe_issues!(issues, issues_seen) if @should_dedupe_issues %>
            <% if issues.any? %>
              <tr>
                <td class="col-md-10">
                  <ul class="list-unstyled">
                    <% issues.each do |issue| %>
                      <li><%= issue.message %> <span class="text-danger">(<%= issue.character %>)</span></li>
                    <% end %>
                  </ul>
                <pre style="margin: 10px"><code class="language-javascript"><%= issues[0].line_contents[0..100] %><%= '...' if issues[0].line_contents.length > 100 %></code></pre>
                </td>
                <td class="col-md-2">
                  line <%= line_number %>
                </td>
              </tr>
            <% end %> <!-- issues.any? -->
          <% end %> <!-- issues_by_line.each -->
        </table>
      <% end %> <!-- issues_by_line.any? -->
    <% end %> <!-- files -->
  <% end %> <!-- all issues -->
<% elsif @build.status == 'waiting' || @build.status == 'queued' %>
  <p class='text-warning'>Build is in progress!</p>
<% else %>
  <p>No issues found! Have a great day!</p>
<% end%>
